<div style=" margin-top: 1%;margin-bottom: 1%;margin-left: 1%;margin-right: 1%;">
    <div class="d-flex">
        <div class="p-3">
            <img style="width:200px" class="rounded float-start" src='<%= @book.image_url %>' alt=''>
        </div>
        <div class="flex-grow-1 p-3 align-self-center">
            <div>
                <h2><%= @book.title %></h2>
            </div>
            <div>
                <p><%= @book.introduction %></p>
            </div>
            <div class="d-flex">
                <p> <%= @book.genre %> </p>
                &nbsp; |&nbsp; 
                <p> <%= @book.user.full_name %> </p>
                &nbsp; |&nbsp; 
                <p><small>Created at: <%= time_ago_in_words(@book.created_at) %></small></p>
            </div>
            <div class="d-flex justify-content-between">
                <div>
                    <%= form_with(model:[@book, @rating], url: book_ratings_path(@book)) do |f|%>
                        <div class="d-flex justify-content-end">
                            <div class="p-2">
                                <%= f.submit "Rate" , class:"btn btn-outline-primary" %>
                            </div>
                            <div class="p-2">
                                <%= f.select :rate, [ ["1", 1], ["2", 2], ["3", 3], ["4", 4], ["5", 5]], {},{ class: "form-select", id:"inlineFormSelectPref" } %>
                            </div>
                            <br>
                        </div>
                    <% end %>
                </div>
                <div class="d-flex">
                    <h2 class="p-2"><%= @book.avg_rating %> &#9733; </h2> 
                </div>
                <br>
            </div>
            <div>
                <% if can? :crud, @book %>   
                    <div class= "d-flex">
                        <div class="pl-2 pt-2 pe-2">
                            <%= button_to 'Edit', edit_book_path(@book), method: :get , class:"btn btn-primary"%>
                        </div>
                        <div class="p-2">
                            <%= button_to 'Delete', book_path(@book), method: :delete, data: { confirm: 'Are you sure?'} , class:"btn btn-primary"%>
                        </div>  
                    </div>
                <% end %>
            </div>
        </div>
    </div>
    
    <div class="mt-3 md-3 ms-3 me-5 pe-5">
        <% @reviews.each do |review| %>
        <div class="card" >
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div class="align-self-center" >
                        <%= review.body%>
                    </div>
                    <div class="p-1">
                        <div class="d-flex">
                            <div style=" position: absolute">
                                    
                                <h1>&#10084;</h1>   
                            </div>
                            <div class="p-3" style="position: relative">
                                <p><%= review.likes.count %></p>   
                            </div>
                        </div>
                    </div>                        
                </div>
                <hr>
                <div>
                    <small>reviewed <%= time_ago_in_words(review.created_at) %> ago by <label>Created by: <%= review.user.full_name%> </label>
                    </small>
                    
                </div>
                <div class="d-flex justify-content-between">
                    <div class="p-2">
                        <small>
                            <% if (review.likes.find_by(user: current_user)).present? %>
                                <%= button_to 'unlike', like_path(review.likes.find_by(user: current_user)), method: :delete, class:"btn btn-info" %>
                            <% else %>
                                <%= button_to 'like', book_review_likes_path(@book ,review), method: :post, class:"btn btn-primary" %>
                            <% end %>
                        </small>                    
                    </div>
                    <div>
                        <% if can? :crud, review %>
                            <div class="d-flex">
                                <div class="p-2">
                                    <%= button_to "Delete", book_review_path(@book.id, review.id), method: :delete, class:"btn btn-primary" %>
                                </div>
                                <div class="p-2">
                                    <%= button_to 'Edit', edit_book_review_path(@book.id, review.id), method: :get , class:"btn btn-primary"%>
                                </div>
                            </div>
                        <% end %>                       
                    </div>
                </div> 
            </div>
        </div>
        <br>
        <% end %>
    </div>
    <div class="p-3 me-5 pe-5">
        <div>
            <h4>Add a review</h4>
        </div>
        <div>
            <%= form_with(model:[@book, @review]) do |f|%>
                <div class="card">
                    <div class="card-body">
                        <%= f.label :body%>
                        <br>
                        <%= f.text_area :body, cols:50, rows: 2 ,class:"form-control" %>
                    </div>
                    <div class="card-body">
                        <%= f.label :select_an_option_please %>
                        <br>
                        <%= f.select :approval, [["save for later", "Nil"], ["submit", "Pending"]] %>
                        <br>
                    </div>                
                </div>
                <div class="d-flex justify-content-end pt-1">
                    <%= f.submit "done" , class:"btn btn-primary" %>
                </div>
            <% end %>         
        </div>
    </div>
</div>
